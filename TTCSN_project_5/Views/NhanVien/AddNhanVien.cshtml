<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="~/asset/css_one/fontawesome-free-6.4.2/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" />
</head>
<style>
    .two {
        color: black;
    }

    table, tr, th {
        border: none;
    }

    th {
        background-color: lightsteelblue;
        border-bottom: 2px white solid;
    }

    tr, th, td {
        padding: 10px;
    }

    td {
        padding: 0;
        padding-left: 30px;
        width: 80%;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 16px;
        width: 100%;
    }

    .title {
        text-align: center;
        margin-bottom: 40px;
        margin-top: 0px;
        padding: 15px 0;
        text-transform: uppercase;
    }

    table {
        position: relative;
        width: 80%;
    }

    .one {
        color: black;
        font-size: 16px;
        font-weight: 800;
        text-decoration: none;
        border: 2px solid black;
        padding: 7px 10px;
        background-color: antiquewhite;
        position: relative;
        top: 0px;
        right: -95px;
    }

    .two {
        color: black;
        font-size: 16px;
        font-weight: 800;
        text-decoration: none;
        border: 2px solid black;
        padding: 7px 10px;
        background-color: antiquewhite;
        position: relative;
        text-align: center;
    }

        .two a {
            text-decoration: none;
        }

    .input_one {
        width: 192px;
        text-align: center;
    }

    input {
        border: none;
        width: calc(100% - 10px);
        outline: none;
        padding: 5px;
        border-bottom: 1px dotted rgba(128, 128, 128, 0.5);
        height: 100%;
    }

    .form__table {
        display: flex;
        width: 100%;
        justify-content: center;
    }

    .gender__name input {
        width: auto;
    }

    #GioiTinh {
        color: blue;
    }

    select {
        border: none;
        width: 100%;
        padding: 5px 0px;
        outline: none;
        border-bottom: 1px dotted rgba(128, 128, 128, 0.5);
        background-color: ghostwhite;
    }

        select:hover {
            cursor: pointer;
            background-color: aliceblue;
        }

    .ngaysinh input:hover {
        cursor: pointer;
    }

    .two, .one {
        border: none;
        padding: 0px;
        border-radius: 10px;
    }

        .two a,
        .one {
            display: block;
            padding: 10px 15px;
        }

            .one:hover {
                cursor: pointer;
            }

    #TaiKhoan::after {
        content: '';
        display: block;
        background-color: red;
        width: 100px;
        height: 100px;
        top: 0;
        left: 0;
    }

    .form_meseage,
    .password_meseage,
    .account_meseage,
    .NameAccount_meseage,
    .account_meseage_Space {
        color: red;
        font-family: 'Segoe UI';
        font-size: 16px;
        display: none;
        transition: 0.6s;
    }

    .form_group {
        width: 100%;
    }
</style>


<body>
    @{
        Layout = "~/Views/Shared/_Layout.cshtml";
    }

    <div style="margin-bottom: 10px;"><button class="two"><a href="@Url.Action("QLNhanVien", "Home")"><i class="fa-solid fa-reply" style="color: darkblue;"></i></a></button></div>
    <h2 class="title">Thêm nhân viên </h2>

    @using (Html.BeginForm("SaveNhanVien", "NhanVien"))
    {

        <div class="form__table">

            <table cellpadding="10" style="border-collapse: collapse;">
                <tr>
                    <th>@Html.Label("Mã nhân viên")</th>
                    <td>
                        <div class="form_group">
                            @Html.TextBox("MaNhanVien")
                            <span class="form_meseage">Mã nhân viên không được để trống!</span>
                            <span class="account_meseage_Space">Mã không là tiếng việt và không chứa khoảng trắng!</span>
                            <span class="account_meseage">Mã nhân viên đã tồn tại!</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>@Html.Label("Tài khoản")</th>
                    <td>
                        <div class="form_group">
                            @Html.TextBox("TaiKhoan")
                            <span class="form_meseage">Tài khoản không được để trống!</span>
                            <span class="account_meseage">Tài khoản không là tiếng việt và không chứa khoảng trắng!</span>
                            <span class="NameAccount_meseage">Tên tài khoản đã tồn tại!</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>@Html.Label("Mật khẩu")</th>
                    <td>
                        <div class="form_group">
                            @Html.Password("MatKhau")
                            <span class="form_meseage">Mật khẩu không được để trống!</span>
                            <span class="password_meseage">Mật khẩu tối thiểu 8 ký tự!</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>@Html.Label("Tên nhân viên")</th>
                    <td>
                        <div class="form_group">
                            @Html.TextBox("HoTen")
                            <span class="form_meseage">Họ tên không được để trống!</span>
                        </div>
                    </td>
                </tr>
                <tr class="ngaysinh">
                    <th>@Html.Label("Ngày sinh")</th>
                    <td>
                        <div class="form_group">
                            <input class="input_one" type="date" name="NgaySinh" id="NgaySinh" />
                            <span class="form_meseage">Ngày sinh không được để trống!</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>@Html.Label("Quê Quán")</th>
                    <td>
                        <div class="form_group">
                            @Html.TextBox("QueQuan")
                            <span class="form_meseage">Quê quán không được để trống!</span>
                        </div>
                    </td>
                </tr>
                <tr class="gender__name">
                    <th>@Html.Label("Giới tính")</th>
                    <td>
                        @Html.RadioButton("GioiTinh", "Nam", true) <span style="margin-right: 20px;">Nam</span>
                        @Html.RadioButton("GioiTinh", "Nữ", false) <span style="margin-right: 20px;">Nữ</span>
                    </td>
                </tr>
                <tr>
                    <th>@Html.Label("Số điện thoại")</th>
                    <td>
                        <div class="form_group">
                            @Html.TextBox("sdt")
                            <span class="form_meseage">Số điện thoại không được để trống!</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>@Html.Label("Phòng Ban")</th>
                    <td>
                        @{
                            List<string> listPhongBan = new List<string>();

                            for (int i = 0; i < ViewBag.lg; i++)
                            {
                                listPhongBan.Add(ViewBag.listpb[i].TenPhongBan);
                            }
                        }
                        @Html.DropDownList("Phongban", new SelectList(listPhongBan, listPhongBan.FirstOrDefault()), "--Phòng Ban--")
                    </td>
                </tr>
                <tr>
                    <th>@Html.Label("Chức vụ")</th>
                    <td>
                        @{
                            List<string> listChucVu = new List<string>();

                            for (int i = 0; i < ViewBag.lgcv; i++)
                            {
                                listChucVu.Add(ViewBag.listcv[i].TenChucVu);
                            }
                        }
                        @Html.DropDownList("ChucVu", new SelectList(listChucVu, listChucVu.FirstOrDefault()), "--Chức vụ--")
                    </td>
                </tr>
                <tr>

                    <td colspan="2" style="padding: 30px 0; text-align: center;">
                        <div style="display: flex; justify-content: center;"><button class="one" type="submit" style=" transform: translateX(-60%); cursor:pointer;">Thêm nhân viên</button></div>
                    </td>
                </tr>
            </table>
            <p>@ViewBag.messeage</p>
        </div>


    }
</body>
</html>
@* check validate form *@
<script>
    var btn_Form = document.querySelector(".one");
    var HoTenElement = document.getElementById("HoTen");
    var TaiKhoanElement = document.getElementById("TaiKhoan");
    var MaNhanVienElement = document.getElementById("MaNhanVien");
    var MatKhauElement = document.getElementById("MatKhau");
    var NgaySinhElement = document.getElementById("NgaySinh");
    var QueQuanElement = document.getElementById("QueQuan");
    var sdtElement = document.getElementById("sdt");
    var formMesseageElement = document.querySelectorAll(".form_meseage");
    var listFormMesseage = Array.from(formMesseageElement);
    var checkIsValueError = true;

        function checkMaNhanVien(element) {
        var parentElement = element.parentNode;
        var MaNhanVienMesseageInGroup = parentElement.querySelector(".account_meseage");
        var valueCheck = element.value.trim();
            var dsMaNhanVien = @Html.Raw(Json.Encode(ViewBag.listMaNhanVien));
            if (checkTiengViet(valueCheck)) {
                checkIsValueError = true;
                parentElement.querySelector(".account_meseage_Space").style.display = 'block';
                checkIsValueError = true;
                return false;
              }
                else {
                parentElement.querySelector(".account_meseage_Space").style.display = 'none';
                if (dsMaNhanVien.some(item => item.toUpperCase() === valueCheck.toUpperCase())) {
                    checkIsValueError = true;
                    MaNhanVienMesseageInGroup.style.display = 'block';
                    return false;
                } else {
                    checkIsValueError = false;
                    MaNhanVienMesseageInGroup.style.display = 'none';
                    return true;
                }
            }
    }
    function checkTenTaiKhoanNhanVien(element) {
        var parentElement = element.parentNode;
        var TenTaiKhoanMesseageInGroup = parentElement.querySelector(".NameAccount_meseage");
        var valueCheck = element.value.trim();
        var dsTaiKhoanNhanVien = @Html.Raw(Json.Encode(ViewBag.listTaiKhoan));
        if (checkTiengViet(valueCheck)) {
            parentElement.querySelector(".account_meseage").style.display = 'block';
            TenTaiKhoanMesseageInGroup.style.display = 'none';
            checkIsValueError = true;
            return false;
        } else
        {
            parentElement.querySelector(".account_meseage").style.display = 'none';
            if (dsTaiKhoanNhanVien.some(item => item === valueCheck)) {
                checkIsValueError = true;
                TenTaiKhoanMesseageInGroup.style.display = 'block';
                return false;
            } else
            {
                checkIsValueError = false;
                TenTaiKhoanMesseageInGroup.style.display = 'none';
                return true;
            }
        }
    }

    function checkTiengViet(inputString) {
        var vietnamesePattern = /[\u00C0-\u1EF9\u1EFA-\u1F00\u0300-\u036F\s]+/;
            return vietnamesePattern.test(inputString);
        }
    function checkTaiKhoan(element) {
        var valueCheck = element.value.trim();
        var parentElement = element.parentNode;
        if (checkTiengViet(valueCheck)) {
            parentElement.querySelector(".account_meseage").style.display = 'block';
            checkIsValueError = true;
        }
        else {
            parentElement.querySelector(".account_meseage").style.display = 'none';
            checkIsValueError = false;
        }
    }
    function checkPassword(element) {
        var valueCheck = element.value.trim();
        var parentElement = element.parentNode;
        if (valueCheck.length < 8) {
            parentElement.querySelector(".password_meseage").style.display = 'block';
            checkIsValueError = true;
        }
        else {
            checkIsValueError = false;
            parentElement.querySelector(".password_meseage").style.display = 'none';
        }
    }
    function change(element) {
        var parentElement = element.parentNode;
        var formMesseageInGroup = parentElement.querySelector(".form_meseage");
        var MaNhanVienMesseageInGroup = parentElement.querySelector(".form_MaPhongBanMeseage");
        var valueCheck = element.value.trim();
        if (valueCheck == "")
        {
            checkIsValueError = true;
        }
        else
        {
            checkIsValueError = false;
            var arrayElement = [MaNhanVienElement ,HoTenElement, TaiKhoanElement, MatKhauElement, NgaySinhElement, QueQuanElement, sdtElement];
            arrayElement.forEach(function (element) {
                if (element.value.trim() == "") {
                    checkIsValueError = true;
                }
                else if (element == MatKhauElement && element.value.trim() != "") {
                    checkPassword(element);
                }
                else if (element == TaiKhoanElement && element.value.trim() != "") {
                   // checkTaiKhoan(element);
                    checkTenTaiKhoanNhanVien(element);
                }
                else if (element == MaNhanVienElement && element.value.trim() != "") {
                    checkMaNhanVien(MaNhanVienElement);
                }
            });
        }
        if (valueCheck == "") {
            formMesseageInGroup.style.display = 'block';
        } else {
            formMesseageInGroup.style.display = 'none';
        }
        element.oninput= function () {
            formMesseageInGroup.style.display = 'none';
        }
        MaNhanVienElement.oninput = function () {
            MaNhanVienElement.parentNode.querySelector(".account_meseage").style.display = 'none';
        }
        MatKhauElement.oninput = function () {
            MatKhauElement.parentNode.querySelector(".password_meseage").style.display = 'none';
        }
        TaiKhoanElement.oninput = function () {
            TaiKhoanElement.parentNode.querySelector(".account_meseage").style.display = 'none';
        }
    }
    HoTenElement.addEventListener("blur", function () { change(HoTenElement) });
    MaNhanVienElement.addEventListener("blur", function () { change(MaNhanVienElement)});
    TaiKhoanElement.addEventListener("blur", function () { change(TaiKhoanElement)});
    MatKhauElement.addEventListener("blur", function () { change(MatKhauElement) });
    NgaySinhElement.addEventListener("blur", function () { change(NgaySinhElement) });
    QueQuanElement.addEventListener("blur", function () { change(QueQuanElement) });
    sdtElement.addEventListener("blur", function () { change(sdtElement) });

    btn_Form.addEventListener("click", (event) => {
        //check từng trường nhập
        var arrayElement = [MaNhanVienElement,HoTenElement, TaiKhoanElement, MatKhauElement, NgaySinhElement, QueQuanElement, sdtElement];
        //check tài khoản
        //check mật khẩu
        var valuePassword = MatKhauElement.value.trim();
        var valueTaiKhoan = TaiKhoanElement.value.trim();
        var valueMaNhanVien = MaNhanVienElement.value.trim();
        var valueTenTaiKhoan = TaiKhoanElement.value.trim();
        if (checkTiengViet(valueTaiKhoan) || valueTaiKhoan == "") {
            checkIsValueError = true;
        } else if (valuePassword.length < 8 || valuePassword == "") {
            checkIsValueError = true;
        }
        if (valueMaNhanVien !== "") {
            if (checkTenTaiKhoanNhanVien(TaiKhoanElement) == true)
            checkMaNhanVien(MaNhanVienElement);
        }
        else if (valueTenTaiKhoan !== "") {
            if (checkMaNhanVien(MaNhanVienElement) == true)
            checkTenTaiKhoanNhanVien(TaiKhoanElement);
        }
        arrayElement.forEach(function (element) {
            var parentElement = element.parentNode;
            var formMesseageInGroup = parentElement.querySelector(".form_meseage");
            if (element.value.trim() == "") {
                formMesseageInGroup.style.display = 'block';
                checkIsValueError = true;
            }
            else if (valuePassword.length < 8 || valuePassword == "") {
                checkIsValueError = true;
                formMesseageInGroup.style.display = 'none';

            }
            else {
                formMesseageInGroup.style.display = 'none';
            }
        });
        if (checkIsValueError) {

            event.preventDefault();
        }

    });
</script>